(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{464:function(s,a,t){"use strict";t.r(a);var n=t(30),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"清理docker占用的磁盘空间"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清理docker占用的磁盘空间"}},[s._v("#")]),s._v(" 清理docker占用的磁盘空间")]),s._v(" "),t("h2",{attrs:{id:"清理无用的磁盘占用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#清理无用的磁盘占用"}},[s._v("#")]),s._v(" 清理无用的磁盘占用")]),s._v(" "),t("p",[t("strong",[s._v("docker system df")]),s._v(" 命令，类似于Linux上的df命令，用于查看Docker的磁盘使用情况：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker system "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v("\nTYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE\nImages              "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".403GB             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".162GB "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("89")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nContainers          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v("                  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(".22MB             0B "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nLocal Volumes       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   0B                  0B\nBuild Cache         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                   0B                  0B\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("strong",[s._v("docker system prune")]),s._v(" 命令可以用于清理磁盘，删除关闭的容器、无用的数据卷和网络，以及dangling镜像（即无tag的镜像）。")]),s._v(" "),t("p",[t("strong",[s._v("docker system prune -a")]),s._v(" 命令清理得更加彻底，可以将没有容器使用Docker镜像都删掉。注意，这两个命令会把你暂时关闭的容器，以及暂时没有用到的Docker镜像都删掉。")]),s._v(" "),t("h2",{attrs:{id:"容器控制台日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#容器控制台日志"}},[s._v("#")]),s._v(" 容器控制台日志")]),s._v(" "),t("p",[s._v("docker运行的服务，输出到控制台的日志(不是你挂载出来的日志文件)是不会自动清理的，日积月累会占用大量的磁盘空间。")]),s._v(" "),t("h3",{attrs:{id:"脚本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#脚本"}},[s._v("#")]),s._v(" 脚本")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh  ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"==================== start clean docker containers logs =========================="')]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("logs")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /var/lib/docker/containers/ -name *-json.log"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("log")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$logs")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("  \n                "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean logs : '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$log")]),s._v('"')]),s._v("  \n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /dev/null "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$log")]),s._v("  \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("  \n\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"==================== end clean docker containers logs   =========================="')]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h2",{attrs:{id:"其他清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他清理"}},[s._v("#")]),s._v(" 其他清理")]),s._v(" "),t("p",[s._v("如果你容器中的服务，把日志或者其他内容，直接保存到了容器内部，没有挂载到宿主机，也没有自动清理，那么时间久了就会堆积占用很大的空间，而这部分空间，只用删除容器的时候才会释放，此时就需要手动排查，是哪个容器占用这么大。")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker system "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("df")]),s._v(" -v\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用上面这个命令，可以查看到每个容器的磁盘空间占用情况，然后执行")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" docker "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -fv 容器名\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这里的 -f 是指强制删除容器，-v 是指带着数据卷一起删除。")]),s._v(" "),t("h2",{attrs:{id:"挂载出来的日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#挂载出来的日志"}},[s._v("#")]),s._v(" 挂载出来的日志")]),s._v(" "),t("p",[s._v("这部分不属于docker占用的清理了，不过经常一起用，所以也整理到这里")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" /data -name "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*.log.*"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);